<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Método de Gauss (LUPA)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .matrix-input { width: 70px; text-align: center; }
    pre { margin: 0; }
    .tab-content table td { min-width: 50px; }
  </style>
</head>
<body>
<div class="container mt-5">
  <h1 class="text-center mb-4">Eliminação de Gauss com LUPA</h1>

  <!-- Escolha do tamanho da matriz -->
  <div class="card mb-4">
    <div class="card-header bg-success text-white">
      <h5 class="mb-0">Escolha a ordem da matriz</h5>
    </div>
    <div class="card-body">
      <form id="matrixForm">
        <div class="mb-3">
          <label class="form-label">Tamanho da matriz:</label>
          <select id="matrixSize" class="form-select" style="max-width: 150px;">
            <option value="2">2x2</option>
            <option value="3" selected>3x3</option>
            <option value="4">4x4</option>
            <option value="5">5x5</option>
            <option value="6">6x6</option>
            <option value="7">7x7</option>
            <option value="8">8x8</option>
            <option value="9">9x9</option>
            <option value="10">10x10</option>
          </select>
        </div>
        <button type="submit" class="btn btn-success">Gerar Matriz</button>
      </form>
    </div>
  </div>

  <!-- Entrada de valores -->
  <div id="matrixContainer" class="card mb-4" style="display:none;">
    <div class="card-header bg-dark text-white">
      <h5 class="mb-0">Insira os valores da matriz A e vetor b</h5>
    </div>
    <div class="card-body">
      <form id="valuesForm">
        <div id="matrixInputs" class="table-responsive"></div>
        <button type="submit" class="btn btn-primary mt-3">Calcular (resolver sistema)</button>
      </form>
    </div>
  </div>

  <!-- Resultados -->
  <div id="resultContainer" class="card" style="display:none;">
    <div class="card-header bg-info text-white">
      <h5 class="mb-0">Resultado</h5>
    </div>
    <div class="card-body">
      <ul class="nav nav-tabs" id="resultTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="solution-tab" data-bs-toggle="tab" data-bs-target="#solution" type="button" role="tab">Solução</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="etapas-tab" data-bs-toggle="tab" data-bs-target="#etapas" type="button" role="tab">Etapas</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="matrices-tab" data-bs-toggle="tab" data-bs-target="#matrices" type="button" role="tab">Matrizes L/U/P/A</button>
        </li>
      </ul>
      <div class="tab-content mt-3">
        <div class="tab-pane fade show active" id="solution" role="tabpanel"></div>
        <div class="tab-pane fade" id="etapas" role="tabpanel"></div>
        <div class="tab-pane fade" id="matrices" role="tabpanel"></div>
      </div>
    </div>
  </div>
</div>

<script>
const matrixForm = document.getElementById("matrixForm");
const matrixContainer = document.getElementById("matrixContainer");
const matrixInputs = document.getElementById("matrixInputs");
const valuesForm = document.getElementById("valuesForm");
const resultContainer = document.getElementById("resultContainer");
const solutionTab = document.getElementById("solution");
const etapasTab = document.getElementById("etapas");
const matricesTab = document.getElementById("matrices");

matrixForm.addEventListener("submit", function(e) {
  e.preventDefault();
  const n = parseInt(document.getElementById("matrixSize").value);
  generateMatrix(n);
});

function generateMatrix(n) {
  let html = `<table class="table table-bordered text-center"><tbody>`;
  for (let i = 0; i < n; i++) {
    html += "<tr>";
    for (let j = 0; j < n; j++) {
      html += `<td><input type="number" step="any" class="form-control matrix-input" name="a${i+1}${j+1}" placeholder="a${i+1}${j+1}"></td>`;
    }
    html += `<td><input type="number" step="any" class="form-control matrix-input" name="b${i+1}" placeholder="b${i+1}"></td>`;
    html += "</tr>";
  }
  html += "</tbody></table>";
  matrixInputs.innerHTML = html;
  matrixContainer.style.display = "block";
}

valuesForm.addEventListener("submit", function(e) {
  e.preventDefault();
  const data = new FormData(valuesForm);
  const n = parseInt(document.getElementById("matrixSize").value);

  let a = [], b = [];
  for (let i = 0; i < n; i++) {
    a[i] = [];
    for (let j = 0; j < n; j++) a[i][j] = parseFloat(data.get(`a${i+1}${j+1}`));
    b[i] = parseFloat(data.get(`b${i+1}`));
  }

  fetch('http://localhost:8080/calculoGauss', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ a, b })
  })
  .then(res => res.json())
  .then(data => renderResult(data))
  .catch(err => {
    solutionTab.innerHTML = `<div class="alert alert-danger">Erro: ${err}</div>`;
    resultContainer.style.display = "block";
  });
});

function renderResult(data) {
  // Solução
  let htmlSol = "<ul>";
  data.solucao.forEach((val,i) => htmlSol += `<li>x<sub>${i+1}</sub> = ${val}</li>`);
  htmlSol += "</ul>";
  solutionTab.innerHTML = htmlSol;

  // Etapas
  let htmlEtapas = "";
  data.etapas.forEach((etapa,idx) => {
    htmlEtapas += `<p><strong>Etapa ${idx+1}:</strong></p>`;
    htmlEtapas += renderMatrix(etapa);
  });
  etapasTab.innerHTML = htmlEtapas;

  // Matrizes L/U/P/A
  let htmlMatrices = "";
  htmlMatrices += `<h6>Matriz A:</h6>${renderMatrix(data.a)}`;
  htmlMatrices += `<h6>Matriz L:</h6>${renderMatrix(data.l)}`;
  htmlMatrices += `<h6>Matriz U:</h6>${renderMatrix(data.u)}`;
  htmlMatrices += `<h6>Matriz P:</h6>${renderMatrix(data.p)}`;
  matricesTab.innerHTML = htmlMatrices;

  resultContainer.style.display = "block";
}

// Função para renderizar matriz como tabela
function renderMatrix(m) {
  let html = "<table class='table table-bordered text-center'><tbody>";
  m.forEach(row => {
    html += "<tr>";
    row.forEach(val => html += `<td>${Number(val).toFixed(3)}</td>`);
    html += "</tr>";
  });
  html += "</tbody></table>";
  return html;
}
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
